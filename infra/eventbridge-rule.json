{
  "Resources": {
    "VideoProcessingDLQ": {
      "Type": "AWS::SQS::Queue"
    },
    "VideoUploadRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "EventPattern": {
          "source": ["aws.s3"],
          "detail-type": ["Object Created"],
          "detail": {
            "bucket": {
              "name": ["input-video-bucket"]
            }
          }
        },
        "Targets": [
          {
            "Arn": { "Ref": "VideoProcessingStateMachine" },
            "Id": "VideoProcessingStateMachineTarget",
            "DeadLetterConfig": {
              "Arn": { "Fn::GetAtt": ["VideoProcessingDLQ", "Arn"] }
            },
            "RetryPolicy": {
              "MaximumEventAgeInSeconds": 3600,
              "MaximumRetryAttempts": 2
            }
          }
        ]
      }
    }
  }
}
